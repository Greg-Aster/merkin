---
import SharedSideBar from '@merkin/blog-core/components/widget/SideBar.astro'
import type { MarkdownHeading } from 'astro'
import { profileConfig } from '../../config/config'
import { avatarConfig, getAvatarIndexFromSlug } from '../../config/avatar.config'
import { getCategoryList } from '../../utils/content-utils'
import { getTagList } from '../../utils/content-utils'
import { getCategoryUrl, url } from '../../utils/url-utils'
import I18nKey from '../../i18n/i18nKey'
import { i18n } from '../../i18n/translation'

interface Props {
  class?: string
  headings?: MarkdownHeading[]
  postSlug?: string
  customAvatar?: string
  customName?: string
  customBio?: string
}

const className = Astro.props.class
const headings = Astro.props.headings
const postSlug = Astro.props.postSlug
const customAvatar = Astro.props.customAvatar
const customName = Astro.props.customName
const customBio = Astro.props.customBio

// Calculate active avatar index from slug
const activeAvatarIndex = postSlug && !customAvatar
  ? getAvatarIndexFromSlug(postSlug, avatarConfig.avatarList.length)
  : 0

// Get categories and tags data
const categories = (await getCategoryList()).map((category) => ({
  name: category.name,
  count: String(category.count),
  url: getCategoryUrl(category.name),
  ariaLabel: `View all posts in the ${category.name} category`,
}))

const tags = (await getTagList()).map((tag) => ({
  name: tag.name,
  count: String(tag.count),
  url: url(`/archive/tag/${tag.name}/`),
  ariaLabel: `View all posts with the ${tag.name} tag`,
}))
---
<SharedSideBar
  class={className}
  headings={headings}
  postSlug={postSlug}
  customAvatar={customAvatar}
  customName={customName}
  customBio={customBio}
  defaultName={profileConfig.name}
  defaultBio={profileConfig.bio}
  socialLinks={profileConfig.links}
  avatarList={avatarConfig.avatarList}
  homeAvatar={avatarConfig.homeAvatar}
  animationInterval={avatarConfig.animationInterval}
  activeAvatarIndex={activeAvatarIndex}
  categories={categories}
  categoriesTitle={i18n(I18nKey.categories)}
  tags={tags}
  tagsTitle={i18n(I18nKey.tags)}
/>
